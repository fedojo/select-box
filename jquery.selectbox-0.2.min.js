/*
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
!function(e,t){function s(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:0,effect:"none",onChange:null,onOpen:null,onClose:null}}var a,n="selectbox",l=!1,i=!0,c={};c.$f=null,e.extend(s.prototype,{_isOpenSelectbox:function(e){if(!e)return l;var t=this._getInst(e);return t.isOpen},_isDisabledSelectbox:function(e){if(!e)return l;var t=this._getInst(e);return t.isDisabled},_attachSelectbox:function(t,s){function o(){var t,s,a=this.attr("id").split("_")[1];for(t in _._state)t!==a&&_._state.hasOwnProperty(t)&&(s=e("select[sb='"+t+"']")[0],s&&_._closeSelectbox(s))}function r(){var s=arguments[1]&&arguments[1].sub?!0:!1,a=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(n){var l,c=e(this),o=e("<li>");c.is(":selected")&&(u.text(c.text()),h=i),n===v-1&&o.addClass("last"),c.is(":disabled")||a?(l=e("<span>",{text:c.text()}).addClass(f.settings.classDisabled),s&&l.addClass(f.settings.classSub),l.appendTo(o)):(l=e("<a>",{href:"#"+c.val(),rel:c.val()}).text(c.text()).bind("click.sb",function(s){s&&s.preventDefault&&s.preventDefault();{var a=b,n=e(this);a.attr("id").split("_")[1]}_._changeSelectbox(t,n.attr("rel"),n.text()),_._closeSelectbox(t)}).bind("mouseover.sb",function(){var t=e(this);t.parent().siblings().find("a").removeClass(f.settings.classFocus),t.addClass(f.settings.classFocus)}).bind("mouseout.sb",function(){e(this).removeClass(f.settings.classFocus)}),s&&l.addClass(f.settings.classSub),c.is(":selected")&&l.addClass(f.settings.classFocus),l.appendTo(o)),o.appendTo(p)})}if(this._getInst(t))return l;var d,u,b,p,g=e(t),_=this,f=_._newInst(g),h=l,x=(g.find("optgroup"),g.find("option")),v=x.length;a=t,g.attr("sb",f.uid),e.extend(f.settings,_._defaults,s),_._state[f.uid]=l,g.hide(),d=e("<div>",{id:"sbHolder_"+f.uid,"class":f.settings.classHolder,tabindex:g.attr("tabindex")}),u=e("<a>",{id:"sbSelector_"+f.uid,href:"#","class":f.settings.classSelector,click:function(s){s.preventDefault(),o.apply(e(this),[]);var a=e(this).attr("id").split("_")[1];_._state[a]?_._closeSelectbox(t):_._openSelectbox(t)}}),b=e("<a>",{id:"sbToggle_"+f.uid,href:"#","class":f.settings.classToggle,click:function(s){s.preventDefault(),o.apply(e(this),[]);var a=e(this).attr("id").split("_")[1];_._state[a]?_._closeSelectbox(t):_._openSelectbox(t)}}),b.appendTo(d),p=e("<ul>",{id:"sbOptions_"+f.uid,"class":f.settings.classOptions,css:{display:"none"}}),g.children().each(function(){var t,s=e(this),a={};s.is("option")?r(s):s.is("optgroup")&&(t=e("<li>"),e("<span>",{text:s.attr("label")}).addClass(f.settings.classGroup).appendTo(t),t.appendTo(p),s.is(":disabled")&&(a.disabled=!0),a.sub=!0,r(s.find("option"),a))}),h||u.text(x.first().text()),e.data(t,n,f),d.data("uid",f.uid).bind("keydown.sb",function(s){var a=s.charCode?s.charCode:s.keyCode?s.keyCode:0,l=e(this),i=l.data("uid"),o=l.siblings("select[sb='"+i+"']").data(n),r=l.siblings(["select[sb='",i,"']"].join("")).get(0),d=l.find("ul").find("a."+o.settings.classFocus);switch(c.$f=d,c.$this=e(this),c.uid=l.data("uid"),c.inst=l.siblings("select[sb='"+i+"']").data(n),c.trgt=l.siblings(["select[sb='",i,"']"].join("")).get(0),a){case 32:s.preventDefault(),_._openSelectbox(t);case 37:case 38:if(d.length>0){var u;e("a",l).removeClass(o.settings.classFocus),u=d.parent().prevAll("li:has(a)").eq(0).find("a"),u.length>0&&(u.addClass(o.settings.classFocus).focus(),e("#sbSelector_"+i).text(u.text()))}break;case 39:case 40:var u;e("a",l).removeClass(o.settings.classFocus),u=d.length>0?d.parent().nextAll("li:has(a)").eq(0).find("a"):l.find("ul").find("a").eq(0),u.length>0&&(u.addClass(o.settings.classFocus).focus(),e("#sbSelector_"+i).text(u.text()));break;case 13:d.length>0&&_._changeSelectbox(r,d.attr("rel"),d.text()),_._closeSelectbox(r);break;case 9:if(s.preventDefault(),r){var o=_._getInst(r);o&&_._closeSelectbox(r)}var b=parseInt(l.attr("tabindex"),10);s.shiftKey?b--:b++,e("*[tabindex='"+b+"']").focus();break;case 27:_._closeSelectbox(r);break;case 65:s.preventDefault(),_._selectLetter("a",_,t);break;case 66:_._selectLetter("b",_,t);break;case 67:_._selectLetter("c",_,t);break;case 68:_._selectLetter("d",_,t);break;case 69:_._selectLetter("e",_,t);break;case 70:_._selectLetter("f",_,t);break;case 71:_._selectLetter("g",_,t);break;case 72:_._selectLetter("h",_,t);break;case 73:_._selectLetter("i",_,t);break;case 74:_._selectLetter("j",_,t);break;case 75:_._selectLetter("k",_,t);break;case 76:_._selectLetter("l",_,t);break;case 77:_._selectLetter("m",_,t);break;case 78:_._selectLetter("n",_,t);break;case 79:_._selectLetter("o",_,t);break;case 80:_._selectLetter("p",_,t);break;case 81:s.preventDefault(),_._selectLetter("q",_,t);break;case 82:_._selectLetter("r",_,t);break;case 83:_._selectLetter("s",_,t);break;case 84:_._selectLetter("t",_,t);break;case 85:_._selectLetter("u",_,t);break;case 86:_._selectLetter("w",_,t);break;case 87:_._selectLetter("x",_,t);break;case 88:_._selectLetter("y",_,t);break;case 89:_._selectLetter("z",_,t)}return s.stopPropagation(),!1}).delegate("a","mouseover",function(){e(this).addClass(f.settings.classFocus)}).delegate("a","mouseout",function(){e(this).removeClass(f.settings.classFocus)}),u.appendTo(d),p.appendTo(d),d.insertAfter(g),e("html").live("mousedown",function(t){t.stopPropagation(),e("select").selectbox("close")}),e([".",f.settings.classHolder,", .",f.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_selectLetter:function(t,s,a){var n=[],l=[],i=null;e(a).children().each(function(){n.push(e(this).text().toLowerCase())}),n.forEach(function(e,s){e[0]==t.toLowerCase()&&(0!=s?l.push(s):null)}),i=l.length>0?l[0]:null,i&&s._changeSelectbox(a,e(a).children().eq(i).val(),e(a).children().eq(i).text())},_detachSelectbox:function(t){var s=this._getInst(t);return s?(e("#sbHolder_"+s.uid).remove(),e.data(t,n,null),void e(t).show()):l},_changeSelectbox:function(t,s,a){var n,l=this._getInst(t);l&&(n=this._get(l,"onChange"),e("#sbSelector_"+l.uid).text(a)),s=s.replace(/\'/g,"\\'"),e(t).find("option[value='"+s+"']").attr("selected",i),l&&n?n.apply(l.input?l.input[0]:null,[s,l]):l&&l.input&&l.input.trigger("change")},_enableSelectbox:function(t){var s=this._getInst(t);return s&&s.isDisabled?(e("#sbHolder_"+s.uid).removeClass(s.settings.classHolderDisabled),s.isDisabled=l,void e.data(t,n,s)):l},_disableSelectbox:function(t){var s=this._getInst(t);return!s||s.isDisabled?l:(e("#sbHolder_"+s.uid).addClass(s.settings.classHolderDisabled),s.isDisabled=i,void e.data(t,n,s))},_optionSelectbox:function(t,s,a){var i=this._getInst(t);return i?(i[s]=a,void e.data(t,n,i)):l},_openSelectbox:function(t){var s=this._getInst(t);if(s&&!s.isOpen&&!s.isDisabled){var a=e("#sbOptions_"+s.uid),l=parseInt(e(window).height(),10),c=e("#sbHolder_"+s.uid).offset(),o=e(window).scrollTop(),r=a.prev().height(),d=l-(c.top-o)-r/2,u=this._get(s,"onOpen");a.css({top:r+"px",maxHeight:d-r+"px"}),"fade"===s.settings.effect?a.fadeIn(s.settings.speed):a.slideDown(s.settings.speed),e("#sbToggle_"+s.uid).addClass(s.settings.classToggleOpen),this._state[s.uid]=i,s.isOpen=i,u&&u.apply(s.input?s.input[0]:null,[s]),e.data(t,n,s)}},_closeSelectbox:function(t){var s=this._getInst(t);if(s&&s.isOpen){var a=this._get(s,"onClose");"fade"===s.settings.effect?e("#sbOptions_"+s.uid).fadeOut(s.settings.speed):e("#sbOptions_"+s.uid).slideUp(s.settings.speed),e("#sbToggle_"+s.uid).removeClass(s.settings.classToggleOpen),this._state[s.uid]=l,s.isOpen=l,a&&a.apply(s.input?s.input[0]:null,[s]),e.data(t,n,s)}},_newInst:function(e){var t=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:t,input:e,uid:Math.floor(99999999*Math.random()),isOpen:l,isDisabled:l,settings:{}}},_getInst:function(t){try{return e.data(t,n)}catch(s){throw"Missing instance data for this selectbox"}},_get:function(e,s){return e.settings[s]!==t?e.settings[s]:this._defaults[s]}}),e.fn.selectbox=function(t){var s=Array.prototype.slice.call(arguments,1);return"string"==typeof t&&"isDisabled"==t?e.selectbox["_"+t+"Selectbox"].apply(e.selectbox,[this[0]].concat(s)):"option"==t&&2==arguments.length&&"string"==typeof arguments[1]?e.selectbox["_"+t+"Selectbox"].apply(e.selectbox,[this[0]].concat(s)):this.each(function(){"string"==typeof t?e.selectbox["_"+t+"Selectbox"].apply(e.selectbox,[this].concat(s)):e.selectbox._attachSelectbox(this,t)})},e.selectbox=new s,e.selectbox.version="0.2"}(jQuery);
